[project]
authors = [{ name = "prefix.dev", email = "noreply@prefix.dev" }]
classifiers = [
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.12",
]
description = "A python project that gets installed in a docker container."
name = "docker-project"
requires-python = ">=3.12"
version = "0.1.0"

[build-system]
build-backend = "hatchling.build"
requires = ["hatchling"]

[tool.pixi.workspace]
channels = ["conda-forge"]
name = "docker-project"
platforms = ["linux-64", "linux-aarch64", "osx-arm64"]

# Dependencies used in the docker container
[tool.pixi.dependencies]
flask = ">=3.0.2,<3.1"
gunicorn = ">=21.2.0,<21.3"

[tool.pixi.feature.dev.pypi-dependencies]
# Installed as editable in development mode for fast iteration
docker-project = { path = ".", editable = true }

[tool.pixi.feature.prod.pypi-dependencies]
# Installed as non-editable in production for a clean deployment
# Both dev and prod can be in the same solve-group despite different editability
docker-project = { path = ".", editable = false }

[tool.pixi.feature.test.dependencies]
pytest = "*"

[tool.pixi.feature.test.tasks]
test = "pytest"

[tool.pixi.tasks]
dev = "flask --app docker_project:app run --debug"
start = "gunicorn -w 4 docker_project:app --bind :8000"

[tool.pixi.environments]
# Default environment for development and testing (editable install)
default = { features = ["test", "dev"], solve-group = "default" }
# Both environments share the same solve-group but have different editability
prod = { features = ["prod"], solve-group = "default" }
